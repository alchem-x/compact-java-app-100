import javax.swing.*;
import javax.swing.border.AbstractBorder;
import java.awt.*;
import java.awt.event.ActionEvent;
import java.awt.event.KeyEvent;
import java.time.LocalDate;
import java.time.YearMonth;
import java.time.format.DateTimeFormatter;
import java.time.format.TextStyle;
import java.util.Locale;

void main(String[] args) {
    SwingUtilities.invokeLater(() -> new CalendarApp().setVisible(true));
}

static class CalendarApp extends JFrame {
    // ===== ËÆæËÆ°Á≥ªÁªüÂ∏∏Èáè =====
    // ‰∏ªË¶ÅÈ¢úËâ≤
    private static final Color BLUE = new Color(0, 122, 255);
    private static final Color GREEN = new Color(52, 199, 89);
    private static final Color RED = new Color(255, 59, 48);
    private static final Color ORANGE = new Color(255, 149, 0);
    private static final Color PURPLE = new Color(175, 82, 222);
    private static final Color TEAL = new Color(48, 176, 199);

    // ‰∏≠ÊÄßËâ≤
    private static final Color BLACK = new Color(0, 0, 0);
    private static final Color WHITE = new Color(255, 255, 255);
    private static final Color GRAY = new Color(142, 142, 147);
    private static final Color GRAY2 = new Color(174, 174, 178);
    private static final Color GRAY3 = new Color(199, 199, 204);
    private static final Color GRAY4 = new Color(209, 209, 214);
    private static final Color GRAY5 = new Color(229, 229, 234);
    private static final Color GRAY6 = new Color(242, 242, 247);

    // ËØ≠‰πâÈ¢úËâ≤
    private static final Color LABEL = new Color(0, 0, 0);
    private static final Color SECONDARY_LABEL = new Color(60, 60, 67, 153);
    private static final Color TERTIARY_LABEL = new Color(60, 60, 67, 76);

    // ËÉåÊôØ
    private static final Color SYSTEM_BACKGROUND = new Color(255, 255, 255);
    private static final Color SECONDARY_SYSTEM_BACKGROUND = new Color(242, 242, 247);

    // Â≠ó‰Ωì
    private static final Font LARGE_TITLE = new Font("SF Pro Display", Font.BOLD, 34);
    private static final Font TITLE1 = new Font("SF Pro Display", Font.BOLD, 28);
    private static final Font TITLE2 = new Font("SF Pro Display", Font.BOLD, 22);
    private static final Font TITLE3 = new Font("SF Pro Display", Font.BOLD, 20);
    private static final Font HEADLINE = new Font("SF Pro Display", Font.BOLD, 17);
    private static final Font SUBHEADLINE = new Font("SF Pro Display", Font.PLAIN, 15);
    private static final Font BODY = new Font("SF Pro Text", Font.PLAIN, 17);
    private static final Font CALLOUT = new Font("SF Pro Text", Font.PLAIN, 16);
    private static final Font FOOTNOTE = new Font("SF Pro Text", Font.PLAIN, 13);
    private static final Font CAPTION1 = new Font("SF Pro Text", Font.PLAIN, 12);
    private static final Font CAPTION2 = new Font("SF Pro Text", Font.PLAIN, 11);

    // Èó¥Ë∑ù
    private static final int SPACING_2 = 2;
    private static final int SPACING_4 = 4;
    private static final int SPACING_8 = 8;
    private static final int SPACING_12 = 12;
    private static final int SPACING_16 = 16;
    private static final int SPACING_20 = 20;
    private static final int SPACING_24 = 24;
    private static final int SPACING_32 = 32;

    // ÂúÜËßí
    private static final int RADIUS_4 = 4;
    private static final int RADIUS_8 = 8;
    private static final int RADIUS_12 = 12;
    private static final int RADIUS_16 = 16;
    private static final int RADIUS_20 = 20;

    // ÊåâÈíÆÂ∞∫ÂØ∏
    private static final Dimension BUTTON_REGULAR = new Dimension(120, 44);
    private static final Dimension BUTTON_LARGE = new Dimension(160, 50);

    // ===== Â∫îÁî®Áä∂ÊÄÅ =====
    private final JLabel monthYearLabel;
    private final JPanel calendarPanel;
    private JButton prevButton;
    private JButton nextButton;
    private JButton todayButton;
    private JLabel selectedDateLabel;

    private YearMonth currentMonth;
    private LocalDate selectedDate;
    private LocalDate today;

    public CalendarApp() {
        today = LocalDate.now();
        currentMonth = YearMonth.now();
        selectedDate = today;

        monthYearLabel = new JLabel();
        calendarPanel = new JPanel();
        prevButton = null; // Â∞ÜÂú®initializeGUI‰∏≠ÂàõÂª∫
        nextButton = null; // Â∞ÜÂú®initializeGUI‰∏≠ÂàõÂª∫
        todayButton = null; // Â∞ÜÂú®initializeGUI‰∏≠ÂàõÂª∫

        this.initializeGUI();
        this.updateCalendar();
        this.setupKeyboardShortcuts();
    }

    private void initializeGUI() {
        setTitle("üìÖ Êó•ÂéÜ");
        setDefaultCloseOperation(JFrame.EXIT_ON_CLOSE);
        setLayout(new BorderLayout());
        getContentPane().setBackground(SYSTEM_BACKGROUND);

        // ‰∏ªÈù¢Êùø - ‰ΩøÁî®ËãπÊûúÈ£éÊ†º
        var mainPanel = new JPanel(new BorderLayout());
        mainPanel.setBackground(SYSTEM_BACKGROUND);
        mainPanel.setBorder(BorderFactory.createEmptyBorder(SPACING_24, SPACING_24, SPACING_24, SPACING_24));

        // Ê†áÈ¢ò - ‰ΩøÁî®ËãπÊûúÈ£éÊ†ºÂ§ßÊ†áÈ¢ò
        var titleLabel = new JLabel("üìÖ Êó•ÂéÜ", SwingConstants.CENTER);
        titleLabel.setFont(TITLE2);
        titleLabel.setForeground(LABEL);
        titleLabel.setBorder(BorderFactory.createEmptyBorder(0, 0, SPACING_24, 0));

        // È°∂ÈÉ®ÂØºËà™Èù¢Êùø - ‰ΩøÁî®ËãπÊûúÈ£éÊ†º
        var navPanel = this.createNavigationPanel();

        // Êó•ÂéÜ‰∏ªÈù¢Êùø - ‰ΩøÁî®ËãπÊûúÈ£éÊ†º
        var calendarContainerPanel = this.createCalendarContainerPanel();

        mainPanel.add(titleLabel, BorderLayout.NORTH);
        mainPanel.add(navPanel, BorderLayout.CENTER);
        mainPanel.add(calendarContainerPanel, BorderLayout.SOUTH);

        add(mainPanel, BorderLayout.CENTER);

        // Â∫ïÈÉ®‰ø°ÊÅØÈù¢Êùø - ‰ΩøÁî®ËãπÊûúÈ£éÊ†º
        var infoPanel = this.createInfoPanel();
        add(infoPanel, BorderLayout.SOUTH);

        setSize(600, 550);
        setLocationRelativeTo(null);
    }

    private JPanel createNavigationPanel() {
        var navPanel = new JPanel(new BorderLayout());
        navPanel.setBackground(SYSTEM_BACKGROUND);
        navPanel.setBorder(BorderFactory.createEmptyBorder(0, 0, SPACING_16, 0));

        // Êúà‰ªΩÂπ¥‰ªΩÊ†áÁ≠æ - ‰ΩøÁî®ËãπÊûúÈ£éÊ†ºÊ†áÈ¢òÂ≠ó‰Ωì
        monthYearLabel.setFont(TITLE3);
        monthYearLabel.setForeground(LABEL);
        monthYearLabel.setHorizontalAlignment(JLabel.CENTER);

        // ÂØºËà™ÊåâÈíÆÈù¢Êùø - ‰ΩøÁî®ËãπÊûúÈ£éÊ†ºÊåâÈíÆ
        var buttonPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, SPACING_12, 0));
        buttonPanel.setBackground(SYSTEM_BACKGROUND);

        prevButton = this.createSecondaryButton("‚óÄ");
        prevButton.setPreferredSize(new Dimension(44, 44));
        prevButton.addActionListener((ev) -> this.previousMonth());

        todayButton = this.createPrimaryButton("‰ªäÂ§©");
        todayButton.setPreferredSize(BUTTON_REGULAR);
        todayButton.addActionListener((ev) -> this.goToToday());

        nextButton = this.createSecondaryButton("‚ñ∂");
        nextButton.setPreferredSize(new Dimension(44, 44));
        nextButton.addActionListener((ev) -> this.nextMonth());

        buttonPanel.add(prevButton);
        buttonPanel.add(todayButton);
        buttonPanel.add(nextButton);

        navPanel.add(monthYearLabel, BorderLayout.CENTER);
        navPanel.add(buttonPanel, BorderLayout.EAST);

        return navPanel;
    }

    private JPanel createCalendarContainerPanel() {
        var containerPanel = new JPanel(new BorderLayout());
        containerPanel.setBackground(SYSTEM_BACKGROUND);
        containerPanel.setBorder(BorderFactory.createCompoundBorder(
            new RoundedBorder(RADIUS_12),
            BorderFactory.createEmptyBorder(SPACING_16, SPACING_16, SPACING_16, SPACING_16)
        ));

        // ÊòüÊúüÊ†áÈ¢òÈù¢Êùø
        var weekDaysPanel = this.createWeekDaysPanel();
        containerPanel.add(weekDaysPanel, BorderLayout.NORTH);

        // Êó•ÂéÜÁΩëÊ†ºÈù¢Êùø
        calendarPanel.setLayout(new GridLayout(6, 7, SPACING_4, SPACING_4));
        calendarPanel.setBackground(SYSTEM_BACKGROUND);
        containerPanel.add(calendarPanel, BorderLayout.CENTER);

        return containerPanel;
    }

    private JPanel createWeekDaysPanel() {
        var weekDaysPanel = new JPanel(new GridLayout(1, 7, SPACING_4, SPACING_4));
        weekDaysPanel.setBackground(SYSTEM_BACKGROUND);

        var weekDays = new String[]{"Êó•", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠"};
        for (var day : weekDays) {
            var label = new JLabel(day, JLabel.CENTER);
            label.setFont(HEADLINE);
            label.setForeground(SECONDARY_LABEL);
            label.setOpaque(true);
            label.setBackground(SECONDARY_SYSTEM_BACKGROUND);
            label.setBorder(BorderFactory.createCompoundBorder(
                new RoundedBorder(RADIUS_4),
                BorderFactory.createEmptyBorder(SPACING_8, SPACING_4, SPACING_8, SPACING_4)
            ));
            weekDaysPanel.add(label);
        }

        return weekDaysPanel;
    }

    private JPanel createInfoPanel() {
        var infoPanel = new JPanel(new FlowLayout(FlowLayout.CENTER, SPACING_16, SPACING_12));
        infoPanel.setBackground(SECONDARY_SYSTEM_BACKGROUND);
        infoPanel.setBorder(BorderFactory.createCompoundBorder(
            BorderFactory.createMatteBorder(1, 0, 0, 0, GRAY4),
            BorderFactory.createEmptyBorder(SPACING_16, SPACING_24, SPACING_16, SPACING_24)
        ));

        selectedDateLabel = new JLabel();
        selectedDateLabel.setFont(CALLOUT);
        selectedDateLabel.setForeground(LABEL);

        infoPanel.add(selectedDateLabel);

        return infoPanel;
    }

    // ===== ÊåâÈíÆÂàõÂª∫ÊñπÊ≥ï =====
    private JButton createPrimaryButton(String text) {
        return this.createStyledButton(text, BLUE, WHITE);
    }

    private JButton createSecondaryButton(String text) {
        return this.createStyledButton(text, GRAY6, LABEL);
    }

    private JButton createStyledButton(String text, Color backgroundColor, Color textColor) {
        var button = new JButton(text);
        button.setFont(HEADLINE);
        button.setBackground(backgroundColor);
        button.setForeground(textColor);
        button.setBorderPainted(false);
        button.setFocusPainted(false);
        button.setContentAreaFilled(true);
        button.setOpaque(true);
        button.setBorder(BorderFactory.createCompoundBorder(
            new RoundedBorder(RADIUS_8),
            BorderFactory.createEmptyBorder(SPACING_12, SPACING_16, SPACING_12, SPACING_16)
        ));
        button.setPreferredSize(BUTTON_REGULAR);

        // ËÆæÁΩÆÊÇ¨ÂÅúÊïàÊûú
        this.setupButtonHoverEffect(button, backgroundColor);

        return button;
    }

    private void setupButtonHoverEffect(JButton button, Color originalColor) {
        button.addMouseListener(new java.awt.event.MouseAdapter() {
            @Override
            public void mouseEntered(java.awt.event.MouseEvent ev) {
                if (button.isEnabled()) {
                    button.setBackground(darkenColor(originalColor, 0.1f));
                    button.setCursor(new Cursor(Cursor.HAND_CURSOR));
                }
            }

            @Override
            public void mouseExited(java.awt.event.MouseEvent ev) {
                if (button.isEnabled()) {
                    button.setBackground(originalColor);
                }
                button.setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
            }
        });
    }

    private Color darkenColor(Color color, float factor) {
        return new Color(
            Math.max(0, (int) (color.getRed() * (1 - factor))),
            Math.max(0, (int) (color.getGreen() * (1 - factor))),
            Math.max(0, (int) (color.getBlue() * (1 - factor))),
            color.getAlpha()
        );
    }

    private javax.swing.border.Border createTitledBorder(String title) {
        var border = BorderFactory.createTitledBorder(title);
        border.setTitleFont(HEADLINE);
        border.setTitleColor(SECONDARY_LABEL);
        return border;
    }

    // ===== ‰∏öÂä°ÈÄªËæëÊñπÊ≥ï =====
    private void updateCalendar() {
        // Êõ¥Êñ∞Êúà‰ªΩÂπ¥‰ªΩÊ†áÁ≠æ
        var monthName = currentMonth.getMonth().getDisplayName(TextStyle.FULL, Locale.CHINESE);
        monthYearLabel.setText(currentMonth.getYear() + "Âπ¥ " + monthName);

        // Ê∏ÖÈô§Áé∞ÊúâÁöÑÊó•ÊúüÊåâÈíÆÔºà‰øùÁïôÊòüÊúüÊ†áÈ¢òÔºâ
        var components = calendarPanel.getComponents();
        for (int i = 0; i < components.length; i++) {
            calendarPanel.remove(components[i]);
        }

        // Ëé∑ÂèñÊúà‰ªΩ‰ø°ÊÅØ
        var firstDay = currentMonth.atDay(1);
        var daysInMonth = currentMonth.lengthOfMonth();
        var startDayOfWeek = firstDay.getDayOfWeek().getValue() % 7; // ËΩ¨Êç¢‰∏∫0=Âë®Êó•ÁöÑÊ†ºÂºè

        // Ê∑ªÂä†ÊòüÊúüÊ†áÈ¢ò
        var weekDays = new String[]{"Êó•", "‰∏Ä", "‰∫å", "‰∏â", "Âõõ", "‰∫î", "ÂÖ≠"};
        for (var day : weekDays) {
            var label = new JLabel(day, JLabel.CENTER);
            label.setFont(HEADLINE);
            label.setForeground(SECONDARY_LABEL);
            label.setOpaque(true);
            label.setBackground(SECONDARY_SYSTEM_BACKGROUND);
            label.setBorder(BorderFactory.createCompoundBorder(
                new RoundedBorder(RADIUS_4),
                BorderFactory.createEmptyBorder(SPACING_8, SPACING_4, SPACING_8, SPACING_4)
            ));
            calendarPanel.add(label);
        }

        // Ê∑ªÂä†Á©∫ÁôΩÂ§©Êï∞
        for (int i = 0; i < startDayOfWeek; i++) {
            var emptyLabel = new JLabel("");
            emptyLabel.setBorder(BorderFactory.createCompoundBorder(
                new RoundedBorder(RADIUS_4),
                BorderFactory.createEmptyBorder(SPACING_8, SPACING_4, SPACING_8, SPACING_4)
            ));
            calendarPanel.add(emptyLabel);
        }

        // Ê∑ªÂä†Êúà‰ªΩ‰∏≠ÁöÑÂ§©Êï∞
        for (int day = 1; day <= daysInMonth; day++) {
            var date = currentMonth.atDay(day);
            var dayButton = createDayButton(date);
            calendarPanel.add(dayButton);
        }

        // Â°´ÂÖÖÂâ©‰ΩôÊ†ºÂ≠ê
        int totalCells = calendarPanel.getComponentCount();
        int remainingCells = 42 - totalCells; // 6Ë°å √ó 7Âàó = 42Ê†º
        for (int i = 0; i < remainingCells; i++) {
            var emptyLabel = new JLabel("");
            emptyLabel.setBorder(BorderFactory.createCompoundBorder(
                new RoundedBorder(RADIUS_4),
                BorderFactory.createEmptyBorder(SPACING_8, SPACING_4, SPACING_8, SPACING_4)
            ));
            calendarPanel.add(emptyLabel);
        }

        // Âà∑Êñ∞ÊòæÁ§∫
        calendarPanel.revalidate();
        calendarPanel.repaint();
    }

    private JButton createDayButton(LocalDate date) {
        var button = new JButton(String.valueOf(date.getDayOfMonth()));
        button.setFont(BODY);
        button.setBorder(BorderFactory.createCompoundBorder(
            new RoundedBorder(RADIUS_4),
            BorderFactory.createEmptyBorder(SPACING_8, SPACING_4, SPACING_8, SPACING_4)
        ));
        button.setFocusPainted(false);

        // ËÆæÁΩÆÊåâÈíÆÊ†∑Âºè
        if (date.equals(today)) {
            // ‰ªäÂ§©
            button.setBackground(BLUE);
            button.setForeground(WHITE);
        } else if (date.equals(selectedDate)) {
            // ÈÄâ‰∏≠ÁöÑÊó•Êúü
            button.setBackground(PURPLE);
            button.setForeground(WHITE);
        } else if (date.getDayOfWeek().getValue() == 6 || date.getDayOfWeek().getValue() == 7) {
            // Âë®Êú´
            button.setBackground(new Color(255, 240, 240));
            button.setForeground(RED);
        } else {
            // ÊôÆÈÄöÂ∑•‰ΩúÊó•
            button.setBackground(WHITE);
            button.setForeground(LABEL);
        }

        // Ê∑ªÂä†ÊÇ¨ÂÅúÊïàÊûú
        this.setupDayButtonHoverEffect(button, date);

        // Ê∑ªÂä†ÁÇπÂáª‰∫ã‰ª∂
        button.addActionListener((ev) -> {
            selectedDate = date;
            this.updateCalendar();
            this.updateSelectedDateInfo();
        });

        return button;
    }

    private void setupDayButtonHoverEffect(JButton button, LocalDate date) {
        button.addMouseListener(new java.awt.event.MouseAdapter() {
            private final Color originalBackground = button.getBackground();
            private final Color originalForeground = button.getForeground();

            @Override
            public void mouseEntered(java.awt.event.MouseEvent ev) {
                if (button.isEnabled()) {
                    if (date.equals(today) || date.equals(selectedDate)) {
                        button.setBackground(darkenColor(originalBackground, 0.1f));
                    } else {
                        button.setBackground(SECONDARY_SYSTEM_BACKGROUND);
                        button.setForeground(LABEL);
                    }
                    button.setCursor(new Cursor(Cursor.HAND_CURSOR));
                }
            }

            @Override
            public void mouseExited(java.awt.event.MouseEvent ev) {
                if (button.isEnabled()) {
                    button.setBackground(originalBackground);
                    button.setForeground(originalForeground);
                }
                button.setCursor(new Cursor(Cursor.DEFAULT_CURSOR));
            }
        });
    }

    private void updateSelectedDateInfo() {
        // Êõ¥Êñ∞Â∫ïÈÉ®ÈÄâ‰∏≠Êó•Êúü‰ø°ÊÅØ
        var formatter = DateTimeFormatter.ofPattern("yyyyÂπ¥MMÊúàddÊó• EEEE", Locale.CHINESE);
        var dayInfo = selectedDate.format(formatter);

        // Ê∑ªÂä†‰∏Ä‰∫õÊúâË∂£ÁöÑ‰ø°ÊÅØ
        var dayOfYear = selectedDate.getDayOfYear();
        var isLeapYear = selectedDate.isLeapYear();

        var extraInfo = String.format(" (Á¨¨%dÂ§©%s)", dayOfYear, isLeapYear ? ", Èó∞Âπ¥" : "");

        selectedDateLabel.setText("ÈÄâ‰∏≠Êó•Êúü: " + dayInfo + extraInfo);
    }

    private void previousMonth() {
        currentMonth = currentMonth.minusMonths(1);
        updateCalendar();
    }

    private void nextMonth() {
        currentMonth = currentMonth.plusMonths(1);
        updateCalendar();
    }

    private void goToToday() {
        currentMonth = YearMonth.from(today);
        selectedDate = today;
        updateCalendar();
        updateSelectedDateInfo();
    }

    private void setupKeyboardShortcuts() {
        // Ê∑ªÂä†ÈîÆÁõòÂØºËà™ÊîØÊåÅ
        this.addKeyListener(new java.awt.event.KeyAdapter() {
            @Override
            public void keyPressed(java.awt.event.KeyEvent ev) {
                int keyCode = ev.getKeyCode();

                switch (keyCode) {
                    case java.awt.event.KeyEvent.VK_LEFT:
                        selectedDate = selectedDate.minusDays(1);
                        break;
                    case java.awt.event.KeyEvent.VK_RIGHT:
                        selectedDate = selectedDate.plusDays(1);
                        break;
                    case java.awt.event.KeyEvent.VK_UP:
                        selectedDate = selectedDate.minusWeeks(1);
                        break;
                    case java.awt.event.KeyEvent.VK_DOWN:
                        selectedDate = selectedDate.plusWeeks(1);
                        break;
                    case java.awt.event.KeyEvent.VK_PAGE_UP:
                        currentMonth = currentMonth.minusMonths(1);
                        break;
                    case java.awt.event.KeyEvent.VK_PAGE_DOWN:
                        currentMonth = currentMonth.plusMonths(1);
                        break;
                    case java.awt.event.KeyEvent.VK_HOME:
                        selectedDate = today;
                        currentMonth = YearMonth.from(today);
                        break;
                    case java.awt.event.KeyEvent.VK_SPACE:
                        // ÊòæÁ§∫ÈÄâ‰∏≠Êó•ÊúüËØ¶ÊÉÖ
                        JOptionPane.showMessageDialog(CalendarApp.this,
                            "ÈÄâ‰∏≠Êó•Êúü: " + selectedDate.format(DateTimeFormatter.ofPattern("yyyyÂπ¥MMÊúàddÊó• EEEE", Locale.CHINA)),
                            "Êó•ÊúüËØ¶ÊÉÖ", JOptionPane.INFORMATION_MESSAGE);
                        return;
                    default:
                        return;
                }

                updateCalendar();
                updateSelectedDateInfo();
            }
        });

        // Á°Æ‰øùÁ™óÂè£ÂèØ‰ª•Ëé∑ÂæóÁÑ¶ÁÇπ
        this.setFocusable(true);
        this.requestFocusInWindow();
    }

    /**
     * ÂúÜËßíËæπÊ°ÜÁ±ª
     */
    private static class RoundedBorder extends AbstractBorder {
        private final int radius;
        private final Color borderColor;
        private final int thickness;

        public RoundedBorder(int radius) {
            this(radius, GRAY3, 1);
        }

        public RoundedBorder(int radius, Color borderColor, int thickness) {
            this.radius = radius;
            this.borderColor = borderColor;
            this.thickness = thickness;
        }

        @Override
        public void paintBorder(Component c, Graphics g, int x, int y, int width, int height) {
            var g2d = (Graphics2D) g.create();
            g2d.setRenderingHint(RenderingHints.KEY_ANTIALIASING, RenderingHints.VALUE_ANTIALIAS_ON);
            g2d.setColor(borderColor);
            g2d.setStroke(new BasicStroke(thickness));
            g2d.drawRoundRect(x, y, width - thickness, height - thickness, radius, radius);
            g2d.dispose();
        }

        @Override
        public Insets getBorderInsets(Component c) {
            return new Insets(thickness, thickness, thickness, thickness);
        }
    }
}